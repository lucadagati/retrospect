' SPDX-License-Identifier: CC-BY-4.0
' Copyright Â© 2025 Wasmbed contributors

@startuml
title Wasmbed Platform - Complete System Architecture (Renode Implementation)

skinparam backgroundColor #FFFFFF
skinparam componentStyle rectangle
skinparam packageStyle rectangle
skinparam noteBackgroundColor #F8F9FA
skinparam noteBorderColor #6C757D
skinparam direction top to bottom

package "Frontend Layer" as Frontend #LightBlue {
    component [React Dashboard] as Dashboard
    component [Terminal Interface] as Terminal
    component [Configuration Wizard] as ConfigWiz
}

package "API Layer" as API #LightGreen {
    component [Dashboard API Server] as APIServer
    component [Health Check Service] as HealthCheck
    component [Compilation Service] as Compiler
}

package "Gateway Layer" as Gateway #LightCoral {
    component [Gateway Server] as GatewayServer
    component [TLS Server] as TLSServer
    component [WASM Runtime] as WASMRuntime
    component [Heartbeat Monitor] as Heartbeat
    component [Certificate Manager] as CertManager
}

package "Device Management" as DeviceMgmt #LightYellow {
    component [Renode Manager] as RenodeManager
    component [Device Controller] as DeviceController
    component [Serial Bridge] as SerialBridge
}

package "Application Management" as AppMgmt #LightPink {
    component [Application Controller] as AppController
    component [WASM Compiler] as WASMCompiler
    component [Deployment Manager] as DeployManager
}

package "Kubernetes Layer" as K8S #LightGray {
    component [Kubernetes API] as K8SAPI
    component [Custom Resource Definitions] as CRDs
    component [Controller Manager] as ControllerMgr
    component [etcd Store] as ETCD
}

package "Device Layer" as Device #LightCyan {
    component [Arduino Nano 33 BLE] as ArduinoNano
    component [STM32F4 Discovery] as STM32F4
    component [Arduino Uno R4] as ArduinoUno
    component [Renode Emulation] as RenodeEmu
}

package "Firmware Layer" as Firmware #LightSteelBlue {
    component [ARM Cortex-M4 Firmware] as ARM_Firmware
    component [TLS Client] as TLSClient
    component [CBOR Protocol] as CBORProto
    component [WASM Runtime Client] as WASMClient
}

' Frontend Layer Connections
Dashboard --> APIServer : HTTP/HTTPS
Terminal --> APIServer : HTTP/HTTPS
ConfigWiz --> APIServer : HTTP/HTTPS

' API Layer Connections
APIServer --> GatewayServer : HTTP/HTTPS
APIServer --> Compiler : Internal
APIServer --> HealthCheck : Internal
APIServer --> K8SAPI : HTTP/HTTPS

' Gateway Layer Connections
GatewayServer --> TLSServer : Internal
GatewayServer --> WASMRuntime : Internal
GatewayServer --> Heartbeat : Internal
GatewayServer --> CertManager : Internal
TLSServer --> TLSClient : TLS 1.3
WASMRuntime --> WASMClient : WASM Protocol

' Device Management Connections
RenodeManager --> RenodeEmu : Process Management
RenodeManager --> SerialBridge : TCP Serial
DeviceController --> K8SAPI : HTTP/HTTPS
DeviceController --> RenodeManager : Internal

' Application Management Connections
AppController --> K8SAPI : HTTP/HTTPS
AppController --> DeployManager : Internal
DeployManager --> GatewayServer : HTTP/HTTPS
WASMCompiler --> Compiler : Internal

' Kubernetes Layer Connections
K8SAPI --> CRDs : Resource Management
K8SAPI --> ControllerMgr : Watch Events
ControllerMgr --> DeviceController : Events
ControllerMgr --> AppController : Events
K8SAPI --> ETCD : State Storage

' Device Layer Connections
RenodeEmu --> ArduinoNano : Platform Emulation
RenodeEmu --> STM32F4 : Platform Emulation
RenodeEmu --> ArduinoUno : Platform Emulation

' Firmware Layer Connections
ArduinoNano --> ARM_Firmware : Execution
STM32F4 --> ARM_Firmware : Execution
ArduinoUno --> ARM_Firmware : Execution
ARM_Firmware --> TLSClient : Internal
ARM_Firmware --> CBORProto : Internal
ARM_Firmware --> WASMClient : Internal

note right of Dashboard
  **React Dashboard**
  - Modern web interface
  - Real-time device monitoring
  - Application deployment
  - System management
end note

note right of APIServer
  **API Server (Port 3001)**
  - REST API endpoints
  - Real-time data
  - Compilation service
  - Health monitoring
end note

note right of GatewayServer
  **Gateway Server (Ports 8080/8081)**
  - TLS 1.3 communication
  - WASM runtime management
  - Device authentication
  - Certificate management
end note

note right of RenodeManager
  **Renode Manager**
  - ARM Cortex-M4 emulation
  - Device lifecycle management
  - Serial communication bridge
  - Platform abstraction
end note

note right of RenodeEmu
  **Renode Emulation**
  - Arduino Nano 33 BLE
  - STM32F4 Discovery
  - Arduino Uno R4
  - Real hardware simulation
end note

note right of ARM_Firmware
  **ARM Cortex-M4 Firmware**
  - Real embedded firmware
  - TLS client implementation
  - CBOR protocol support
  - WASM runtime integration
end note

note right of K8SAPI
  **Kubernetes Integration**
  - Custom Resource Definitions
  - Controller pattern
  - State reconciliation
  - Event-driven architecture
end note

@enduml

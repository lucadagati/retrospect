' SPDX-License-Identifier: CC-BY-4.0
' Copyright Â© 2025 Wasmbed contributors

@startuml
title Wasmbed Platform - Renode Device Architecture

skinparam backgroundColor #FFFFFF
skinparam componentStyle rectangle
skinparam packageStyle rectangle
skinparam noteBackgroundColor #F8F9FA
skinparam noteBorderColor #6C757D
skinparam direction top to bottom

package "Renode Emulation Layer" as RenodeLayer #LightBlue {
    component [Renode Core] as RenodeCore
    component [Platform Manager] as PlatformMgr
    component [Device Simulator] as DeviceSim
    component [Serial Bridge] as SerialBridge
}

package "Arduino Nano 33 BLE" as ArduinoNano #LightGreen {
    component [ARM Cortex-M4 CPU] as CortexM4
    component [1MB RAM] as RAM1MB
    component [256KB Flash] as Flash256KB
    component [Bluetooth LE] as BLE
    component [IMU Sensor] as IMU
    component [Temperature Sensor] as TempSensor
}

package "STM32F4 Discovery" as STM32F4 #LightCoral {
    component [ARM Cortex-M4 CPU] as CortexM4_STM32
    component [1MB RAM] as RAM1MB_STM32
    component [1MB Flash] as Flash1MB_STM32
    component [Audio Codec] as AudioCodec
    component [Accelerometer] as Accelerometer
    component [Gyroscope] as Gyroscope
}

package "Arduino Uno R4" as ArduinoUno #LightYellow {
    component [ARM Cortex-M4 CPU] as CortexM4_Uno
    component [512KB RAM] as RAM512KB
    component [256KB Flash] as Flash256KB_Uno
    component [WiFi Module] as WiFi
    component [Bluetooth] as Bluetooth
    component [RTC] as RTC
}

package "Firmware Layer" as FirmwareLayer #LightPink {
    component [ARM Cortex-M4 Firmware] as ARM_Firmware
    component [Network Stack] as NetworkStack
    component [TLS Client] as TLSClient
    component [CBOR Protocol] as CBORProto
    component [WASM Runtime] as WASMRuntime
    component [Device Drivers] as DeviceDrivers
}

package "Communication Layer" as CommLayer #LightGray {
    component [TCP Serial Bridge] as TCPSerial
    component [UART Interface] as UART
    component [Serial Protocol] as SerialProto
    component [Message Handler] as MsgHandler
}

package "Gateway Integration" as GatewayInt #LightCyan {
    component [Renode Manager] as RenodeManager
    component [Device Controller] as DeviceController
    component [Platform Controller] as PlatformController
    component [Status Monitor] as StatusMonitor
}

' Renode Layer Connections
RenodeCore --> PlatformMgr : Platform Management
PlatformMgr --> DeviceSim : Device Simulation
DeviceSim --> SerialBridge : Serial Communication
SerialBridge --> TCPSerial : TCP Bridge

' Arduino Nano 33 BLE Connections
RenodeCore --> CortexM4 : CPU Emulation
CortexM4 --> RAM1MB : Memory Access
CortexM4 --> Flash256KB : Program Storage
CortexM4 --> BLE : Bluetooth Communication
CortexM4 --> IMU : Sensor Interface
CortexM4 --> TempSensor : Temperature Reading

' STM32F4 Discovery Connections
RenodeCore --> CortexM4_STM32 : CPU Emulation
CortexM4_STM32 --> RAM1MB_STM32 : Memory Access
CortexM4_STM32 --> Flash1MB_STM32 : Program Storage
CortexM4_STM32 --> AudioCodec : Audio Processing
CortexM4_STM32 --> Accelerometer : Motion Detection
CortexM4_STM32 --> Gyroscope : Orientation Sensing

' Arduino Uno R4 Connections
RenodeCore --> CortexM4_Uno : CPU Emulation
CortexM4_Uno --> RAM512KB : Memory Access
CortexM4_Uno --> Flash256KB_Uno : Program Storage
CortexM4_Uno --> WiFi : Wireless Communication
CortexM4_Uno --> Bluetooth : Bluetooth Communication
CortexM4_Uno --> RTC : Real-time Clock

' Firmware Layer Connections
CortexM4 --> ARM_Firmware : Firmware Execution
CortexM4_STM32 --> ARM_Firmware : Firmware Execution
CortexM4_Uno --> ARM_Firmware : Firmware Execution
ARM_Firmware --> NetworkStack : Network Operations
ARM_Firmware --> TLSClient : Secure Communication
ARM_Firmware --> CBORProto : Data Serialization
ARM_Firmware --> WASMRuntime : WASM Execution
ARM_Firmware --> DeviceDrivers : Hardware Access

' Communication Layer Connections
SerialBridge --> TCPSerial : Serial to TCP
TCPSerial --> UART : UART Interface
UART --> SerialProto : Serial Protocol
SerialProto --> MsgHandler : Message Processing
MsgHandler --> TLSClient : Secure Messages

' Gateway Integration Connections
RenodeManager --> RenodeCore : Process Management
RenodeManager --> PlatformMgr : Platform Control
DeviceController --> RenodeManager : Device Management
PlatformController --> PlatformMgr : Platform Control
StatusMonitor --> DeviceSim : Status Monitoring

note right of RenodeCore
  **Renode Core**
  - ARM Cortex-M4 emulation
  - Real-time simulation
  - Hardware abstraction
  - Platform support
end note

note right of CortexM4
  **ARM Cortex-M4 CPU**
  - 32-bit ARM processor
  - Floating Point Unit (FPU)
  - Real-time capabilities
  - Low power consumption
end note

note right of ARM_Firmware
  **ARM Cortex-M4 Firmware**
  - Real embedded firmware
  - no_std Rust environment
  - TLS client implementation
  - WASM runtime integration
end note

note right of TCPSerial
  **TCP Serial Bridge**
  - Bidirectional communication
  - Configurable ports
  - Protocol translation
  - External device access
end note

note right of RenodeManager
  **Renode Manager**
  - Device lifecycle management
  - Platform abstraction
  - Process control
  - Status monitoring
end note

@enduml

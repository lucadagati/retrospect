' SPDX-License-Identifier: CC-BY-4.0
' Copyright Â© 2025 Wasmbed contributors

@startuml
title Wasmbed Platform - High Level Architecture

skinparam backgroundColor #FFFFFF
skinparam componentStyle rectangle
skinparam packageStyle rectangle
skinparam noteBackgroundColor #F8F9FA
skinparam noteBorderColor #6C757D
skinparam direction top to bottom

package "User Interface" as UI #LightBlue {
    component [React Dashboard] as Dashboard
    component [Terminal Interface] as Terminal
}

package "API Gateway" as API #LightGreen {
    component [Dashboard API Server] as APIServer
    component [Gateway Server] as GatewayServer
}

package "Device Management" as DeviceMgmt #LightCoral {
    component [Renode Manager] as RenodeManager
    component [Device Controller] as DeviceController
}

package "Application Management" as AppMgmt #LightYellow {
    component [Application Controller] as AppController
    component [WASM Runtime] as WASMRuntime
}

package "Kubernetes Platform" as K8S #LightPink {
    component [Kubernetes API] as K8SAPI
    component [Custom Resource Definitions] as CRDs
}

package "Constrained Devices" as Devices #LightGray {
    component [Arduino Nano 33 BLE] as ArduinoNano
    component [STM32F4 Discovery] as STM32F4
    component [Arduino Uno R4] as ArduinoUno
}

' Main Connections
Dashboard --> APIServer : HTTP/HTTPS
Terminal --> APIServer : HTTP/HTTPS
APIServer --> GatewayServer : HTTP/HTTPS
APIServer --> K8SAPI : HTTP/HTTPS

GatewayServer --> RenodeManager : Device Management
GatewayServer --> WASMRuntime : Application Execution

RenodeManager --> ArduinoNano : ARM Cortex-M4
RenodeManager --> STM32F4 : ARM Cortex-M4
RenodeManager --> ArduinoUno : ARM Cortex-M4

DeviceController --> K8SAPI : Resource Management
AppController --> K8SAPI : Resource Management
K8SAPI --> CRDs : State Storage

note right of Dashboard
  **React Dashboard**
  - Modern web interface
  - Real-time monitoring
  - Application deployment
end note

note right of GatewayServer
  **Gateway Server**
  - TLS 1.3 communication
  - WASM runtime management
  - Device authentication
end note

note right of RenodeManager
  **Renode Manager**
  - ARM Cortex-M4 emulation
  - Device lifecycle management
  - Platform abstraction
end note

note right of K8SAPI
  **Kubernetes Integration**
  - Custom Resource Definitions
  - Controller pattern
  - State reconciliation
end note

@enduml

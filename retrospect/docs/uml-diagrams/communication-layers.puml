' SPDX-License-Identifier: CC-BY-4.0
' Copyright Â© 2025 Wasmbed contributors

@startuml
title Wasmbed Platform - Communication Layers

skinparam backgroundColor #FFFFFF
skinparam componentStyle rectangle
skinparam packageStyle rectangle
skinparam noteBackgroundColor #F8F9FA
skinparam noteBorderColor #6C757D
skinparam direction top to bottom

package "Frontend Layer" as Frontend #LightBlue {
    component [React Dashboard] as Dashboard
    component [Terminal Interface] as Terminal
    component [Configuration Wizard] as ConfigWiz
}

package "API Layer" as API #LightGreen {
    component [Dashboard API Server] as APIServer
    component [Health Check Service] as HealthCheck
    component [Compilation Service] as Compiler
}

package "Gateway Layer" as Gateway #LightCoral {
    component [Gateway Server] as GatewayServer
    component [TLS Server] as TLSServer
    component [WASM Runtime] as WASMRuntime
    component [Heartbeat Monitor] as Heartbeat
}

package "Device Layer" as Device #LightYellow {
    component [Renode Manager] as RenodeManager
    component [Serial Bridge] as SerialBridge
    component [Device Controller] as DeviceController
}

package "Infrastructure Layer" as Infra #LightPink {
    component [Kubernetes API] as K8SAPI
    component [Custom Resource Definitions] as CRDs
    component [Controller Manager] as ControllerMgr
}

' Layer Connections
Frontend --> API : HTTP/HTTPS
API --> Gateway : HTTP/HTTPS
Gateway --> Device : TLS 1.3
Device --> Infra : HTTP/HTTPS

' Internal Connections
Dashboard --> APIServer : REST API
Terminal --> APIServer : REST API
ConfigWiz --> APIServer : REST API

APIServer --> GatewayServer : Internal
APIServer --> HealthCheck : Internal
APIServer --> Compiler : Internal

GatewayServer --> TLSServer : Internal
GatewayServer --> WASMRuntime : Internal
GatewayServer --> Heartbeat : Internal

RenodeManager --> SerialBridge : TCP Serial
RenodeManager --> DeviceController : Internal

K8SAPI --> CRDs : Resource Management
K8SAPI --> ControllerMgr : Watch Events

note right of Frontend
  **Frontend Layer**
  - User interfaces
  - Configuration tools
  - Real-time monitoring
end note

note right of API
  **API Layer**
  - REST endpoints
  - Service orchestration
  - Health monitoring
end note

note right of Gateway
  **Gateway Layer**
  - TLS communication
  - WASM execution
  - Device management
end note

note right of Device
  **Device Layer**
  - Renode emulation
  - Serial communication
  - Device control
end note

note right of Infra
  **Infrastructure Layer**
  - Kubernetes platform
  - Resource management
  - Event processing
end note

@enduml

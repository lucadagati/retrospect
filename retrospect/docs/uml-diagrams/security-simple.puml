' SPDX-License-Identifier: CC-BY-4.0
' Copyright Â© 2025 Wasmbed contributors

@startuml
title Wasmbed Platform - Security Architecture

skinparam backgroundColor #FFFFFF
skinparam componentStyle rectangle
skinparam packageStyle rectangle
skinparam noteBackgroundColor #F8F9FA
skinparam noteBorderColor #6C757D
skinparam direction top to bottom

package "Certificate Authority" as CA #LightBlue {
    component [Root CA] as RootCA
    component [Certificate Generator] as CertGen
    component [Certificate Validator] as CertValidator
}

package "Gateway Security" as GatewaySec #LightGreen {
    component [TLS Server] as TLSServer
    component [Certificate Manager] as CertManager
    component [Client Authentication] as ClientAuth
}

package "Device Security" as DeviceSec #LightCoral {
    component [TLS Client] as TLSClient
    component [Device Certificate] as DeviceCert
    component [Certificate Store] as DeviceCertStore
}

package "Communication Security" as CommSec #LightYellow {
    component [TLS 1.3 Protocol] as TLS13
    component [CBOR Encryption] as CBOREnc
    component [Message Authentication] as MsgAuth
}

package "Infrastructure Security" as InfraSec #LightPink {
    component [Kubernetes RBAC] as K8SRBAC
    component [Network Policies] as NetPolicies
    component [Secret Management] as SecretMgr
}

package "Application Security" as AppSec #LightGray {
    component [WASM Sandbox] as WASMSandbox
    component [Memory Protection] as MemProt
    component [Resource Limits] as ResLimits
}

' Certificate Authority Connections
RootCA --> CertGen : Generate Certificates
CertGen --> CertValidator : Validate Certificates

' Gateway Security Connections
TLSServer --> CertManager : Certificate Management
CertManager --> ClientAuth : Client Authentication

' Device Security Connections
TLSClient --> DeviceCert : Certificate Usage
DeviceCert --> DeviceCertStore : Certificate Storage

' Communication Security Connections
TLSServer --> TLS13 : TLS Protocol
TLSClient --> TLS13 : TLS Protocol
TLS13 --> CBOREnc : Encrypted Communication
CBOREnc --> MsgAuth : Message Authentication

' Infrastructure Security Connections
K8SRBAC --> NetPolicies : Access Control
NetPolicies --> SecretMgr : Secret Access

' Application Security Connections
WASMSandbox --> MemProt : Memory Isolation
MemProt --> ResLimits : Resource Control

' Cross-Layer Security Connections
CertManager --> RootCA : Certificate Validation
DeviceCertStore --> RootCA : Certificate Chain
TLSServer --> K8SRBAC : Access Control
TLSClient --> WASMSandbox : Secure Execution

note right of RootCA
  **Certificate Authority**
  - X.509 v3 certificates
  - RSA 4096-bit keys
  - Certificate chain validation
end note

note right of TLSServer
  **TLS Server (Port 8081)**
  - TLS 1.3 protocol
  - Mutual authentication
  - rustls implementation
end note

note right of TLSClient
  **TLS Client**
  - Device authentication
  - Certificate validation
  - Encrypted communication
end note

note right of TLS13
  **TLS 1.3 Protocol**
  - Perfect Forward Secrecy
  - Mutual authentication
  - Certificate validation
end note

note right of WASMSandbox
  **WASM Sandbox**
  - Memory isolation
  - Resource limits
  - Code validation
end note

note right of K8SRBAC
  **Kubernetes RBAC**
  - Role-based access control
  - Service accounts
  - Permission management
end note

@enduml

' SPDX-License-Identifier: CC-BY-4.0
' Copyright Â© 2025 Wasmbed contributors

@startuml
title Wasmbed Platform - Application Deployment Flow

skinparam backgroundColor #FFFFFF
skinparam componentStyle rectangle
skinparam packageStyle rectangle
skinparam noteBackgroundColor #F8F9FA
skinparam noteBorderColor #6C757D
skinparam direction top to bottom

package "Application Development" as AppDev #LightBlue {
    component [Rust Source Code] as RustCode
    component [Rust Compiler] as RustCompiler
    component [WASM Binary] as WASMBinary
}

package "Deployment Pipeline" as DeployPipe #LightGreen {
    component [Compilation Service] as CompileService
    component [Binary Validator] as BinaryValidator
    component [Deployment Manager] as DeployManager
}

package "Gateway Runtime" as GatewayRT #LightCoral {
    component [WASM Engine] as WASMEngine
    component [Module Loader] as ModuleLoader
    component [Execution Context] as ExecContext
}

package "Device Runtime" as DeviceRT #LightYellow {
    component [WASM Runtime Client] as WASMClient
    component [Memory Manager] as MemManager
    component [Function Executor] as FuncExecutor
}

package "Monitoring" as Monitor #LightPink {
    component [Performance Monitor] as PerfMonitor
    component [Health Checker] as HealthChecker
    component [Metrics Collector] as MetricsCollector
}

package "Kubernetes Integration" as K8SInt #LightGray {
    component [Application CRD] as AppCRD
    component [Application Controller] as AppController
    component [Status Reconciler] as StatusReconciler
}

' Application Development Connections
RustCode --> RustCompiler : Compilation
RustCompiler --> WASMBinary : Binary Generation
WASMBinary --> CompileService : Deployment Request

' Deployment Pipeline Connections
CompileService --> BinaryValidator : Validation
BinaryValidator --> DeployManager : Validated Binary
DeployManager --> GatewayRT : Deployment Request

' Gateway Runtime Connections
GatewayRT --> WASMEngine : Engine Initialization
WASMEngine --> ModuleLoader : Module Loading
ModuleLoader --> ExecContext : Context Creation

' Device Runtime Connections
GatewayRT --> WASMClient : Binary Transfer
WASMClient --> MemManager : Memory Allocation
MemManager --> FuncExecutor : Function Execution

' Monitoring Connections
DeviceRT --> PerfMonitor : Performance Data
PerfMonitor --> HealthChecker : Health Assessment
HealthChecker --> MetricsCollector : Metrics Collection

' Kubernetes Integration Connections
DeployManager --> AppCRD : Resource Creation
AppCRD --> AppController : Event Notification
AppController --> StatusReconciler : Status Reconciliation

' Cross-Layer Connections
MetricsCollector --> AppController : Status Updates
AppController --> DeployManager : Deployment Control

note right of RustCode
  **Rust Source Code**
  - no_std compatible
  - ARM Cortex-M4 target
  - WebAssembly output
end note

note right of WASMEngine
  **WASM Engine (wasmtime)**
  - WebAssembly runtime
  - Module validation
  - Function execution
end note

note right of WASMClient
  **WASM Runtime Client**
  - Device-side execution
  - Memory constraints
  - Real-time execution
end note

note right of AppCRD
  **Application CRD**
  - Kubernetes resource
  - WASM binary storage
  - Deployment status
end note

note right of PerfMonitor
  **Performance Monitor**
  - Real-time metrics
  - Resource usage
  - Execution statistics
end note

@enduml
